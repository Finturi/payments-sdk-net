@{
    ViewBag.Title = "Choose your payment method";
}
<div class="row bs-wizard" style="border-bottom: 0;">
    <div class="col-xs-3 bs-wizard-step complete">
        <div class="text-center bs-wizard-stepnum">Cart</div>
        <div class="progress">
            <div class="progress-bar"></div>
        </div>
        <a href="@Url.Action("Cart", "Home")" class="bs-wizard-dot"></a>
    </div>

    <div class="col-xs-3 bs-wizard-step complete">
        <div class="text-center bs-wizard-stepnum">Details</div>
        <div class="progress">
            <div class="progress-bar"></div>
        </div>
        <a href="@Url.Action("Index", "Checkout")" class="bs-wizard-dot"></a>
    </div>

    <div class="col-xs-3 bs-wizard-step active">
        <div class="text-center bs-wizard-stepnum">Payment</div>
        <div class="progress">
            <div class="progress-bar"></div>
        </div>
        <a href="#" class="bs-wizard-dot"></a>
    </div>
    <div class="col-xs-3 bs-wizard-step disabled">
        <div class="text-center bs-wizard-stepnum">Confirmation</div>
        <div class="progress">
            <div class="progress-bar"></div>
        </div>
        <a href="#" class="bs-wizard-dot"></a>
    </div>
</div>
@if (ViewBag.Status == "cancelled")
{
    <div class="alert alert-warning" id="message" role="alert">
        <strong>Oops!</strong> Seems like your payment has been cancelled. Please, try again.
    </div>
}

<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 col-lg-offset-3 col-md-offset-3">
        <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                            iDeal
                        </a>
                    </h4>
                </div>
                <div id="collapse1" class="panel-collapse collapse in">
                    <div class="panel-body">
                        <div class="form-group">
                            <select class="form-control" id="idealIssuerId" data-method="ideal">
                                <option value="0" selected disabled>Kies uw bank...</option>
                                <option value="RABONL2U">Rabobank</option>
                                <option value="ABNANL2A">ABN Amro</option>
                                <option value="FVLBNL22">Van Lanschot Bankiers</option>
                                <option value="TRIONL2U">Triodos Bank</option>
                                <option value="INGBNL2A">ING</option>
                                <option value="SNSBNL2A">SNS Bank</option>
                                <option value="ASNBNL21">ASN Bank</option>
                                <option value="RBRBNL21">RegioBank</option>
                                <option value="KNABNL2H">Knab</option>
                                <option value="BUNQNL2A">bunq</option>
                            </select>
                        </div>
                        <button id="ideal" data-method="ideal" data-loading-text="Loading..." class="btn btn-default disabled">
                            <img src="~/Content/images/IDEAL.png" width="25" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                            PayPal
                        </a>
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse">
                    <div class="panel-body">
                        <button data-method="paypal" class="btn btn-default">
                            <img src="~/Content/images/PayPal.png" width="90" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                            Creditcard
                        </a>
                    </h4>
                </div>
                <div id="collapse3" class="panel-collapse collapse">
                    <div class="panel-body">
                        <button data-method="creditcard" class="btn btn-default">
                            <img src="~/Content/images/Creditcard.png" width="100" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">
                            AfterPay
                        </a>
                    </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse">
                    <div class="panel-body">
                        <button data-method="afterpay" class="btn btn-default">
                            <img src="~/Content/images/afterpay.png" width="100" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse5">
                            Sofort
                        </a>
                    </h4>
                </div>
                <div id="collapse5" class="panel-collapse collapse">
                    <div class="panel-body">
                        <div class="form-group">
                            <select class="form-control" id="sofortIssuerId" data-method="sofort">
                                <option value="0" selected disabled>Kies uw bank...</option>
                                <option value="RABONL2U">Rabobank</option>
                                <option value="ABNANL2A">ABN Amro</option>
                                <option value="INGBNL2A">ING</option>
                                <option value="SNSBNL2A">SNS Bank</option>
                                <option value="RBRBNL21">RegioBank</option>
                            </select>
                        </div>
                        <button id="sofort" data-method="sofort" class="btn btn-default disabled">
                            <img src="~/Content/images/Sofort.png" width="100" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse6">
                            Bancontact
                        </a>
                    </h4>
                </div>
                <div id="collapse6" class="panel-collapse collapse">
                    <div class="panel-body">
                        <button data-method="bancontact" class="btn btn-default">
                            <img src="~/Content/images/Bancontact.png" width="60" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse7">
                            Wire Transfer
                        </a>
                    </h4>
                </div>
                <div id="collapse7" class="panel-collapse collapse">
                    <div class="panel-body">
                        <button data-method="wiretransfer" class="btn btn-default">
                            <img src="~/Content/images/WireTransfer.png" width="60" alt=""/>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(function() {
        $(".btn").click(function() {
            var $btn = $(this).button('loading');
            var method = $(this).data("method");
            var data;
            switch (method) {
                case 'ideal':
                    data = $("#idealIssuerId").val();
                    if (data != null)
                        ajaxPost(method, data, $btn);
                    break;
                case 'paypal':
                    ajaxPost(method, '');
                    break;
                case 'creditcard':
                    ajaxPost(method, '');
                    break;
                case 'afterpay':
                    ajaxPost(method, '');
                    break;
                case 'sofort':
                    data = $("#sofortIssuerId").val();
                    ajaxPost(method, data);
                    break;
                case 'bancontact':
                    ajaxPost(method, '');
                    break;
                case 'wiretransfer':
                    ajaxPost(method, '');
                    break;

            }
        });

        $('select').change(function() {
            var method = '#' + $(this).data("method");
            var value = $(this).val();
            if (value === "0")
                $(method).addClass("disabled");
            else
                $(method).removeClass("disabled");
        });

        function ajaxPost(method, data) {
            $.ajax({
                url: "@Url.Action("Method")",
                method: "POST",
                data: { method: method, data: data },
                success: function(msg) {
                    if (msg.AuthUrl != null)
                        window.location = msg.AuthUrl;
                    else
                        window.location = "@Url.Action("Success")";
                }
            });
        }
    });
</script>